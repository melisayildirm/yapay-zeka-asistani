<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Gereksinim Analiz AsistanÄ±</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <header>
            <h1><span class="icon">ðŸ’¡</span> AI Destekli Gereksinim Analiz AsistanÄ±</h1>
        </header>

        <main>
            <p>Projenizin senaryo metnini girin veya bir PDF dosyasÄ± yÃ¼kleyerek analiz ettirin.</p>

            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}

                {# Genel form hatalarÄ±nÄ± gÃ¶ster #}
                {% if form.non_field_errors %}
                    <ul class="errorlist">
                        {% for error in form.non_field_errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}

                <div class="form-group input-section">
                    <label for="{{ form.senaryo_metni.id_for_label }}">Senaryo Metni:</label>
                    {{ form.senaryo_metni }}
                    {% if form.senaryo_metni.errors %}
                        <ul class="errorlist">
                            {% for error in form.senaryo_metni.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>

                <div class="or-separator">
                    <span>VEYA</span>
                </div>

                <div class="form-group file-upload-section">
                    <label for="pdfDosyasiYukle">PDF DosyasÄ± YÃ¼kle:</label>
                    <div class="custom-file-upload">
                        {{ form.pdf_dosyasi }}
                        <label for="{{ form.pdf_dosyasi.id_for_label }}" class="upload-button">Dosya SeÃ§</label>
                        <span id="file-name" class="selected-file-name">Dosya seÃ§ilmedi</span>
                    </div>
                    {% if form.pdf_dosyasi.errors %}
                        <ul class="errorlist">
                            {% for error in form.pdf_dosyasi.errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                </div>

                <button type="submit" class="analyze-button">Senaryoyu Analiz Et</button>
            </form>

            {# AI'ya gÃ¶nderilen metnin Ã¶nizlemesi #}
            {% if original_senaryo_metni_preview %}
                <div class="original-text-preview">
                    <h3>GiriÅŸ Metni Ã–nizlemesi (Ä°lk 500 Karakter):</h3>
                    <p>{{ original_senaryo_metni_preview }}</p>
                </div>
            {% endif %}

            {# Hata mesajlarÄ± #}
            {% if hata_mesaji %}
                <div class="error">Hata: {{ hata_mesaji }}</div>
            {% endif %}

            {# Analiz sonucu #}
            {% if analiz_sonucu %}
                <div class="result">
                    <h2><span class="icon">ðŸ¤–</span> Gemini'den Gelen Senaryo Analizi</h2>
                    {{ analiz_sonucu|safe }}
                </div>
            {% endif %}
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('{{ form.pdf_dosyasi.id_for_label }}');
            const fileNameSpan = document.getElementById('file-name');

            if (fileInput) {
                fileInput.addEventListener('change', function() {
                    if (this.files && this.files.length > 0) {
                        fileNameSpan.textContent = this.files[0].name;
                    } else {
                        fileNameSpan.textContent = 'Dosya seÃ§ilmedi';
                    }
                });
            }
        });
    </script>
</body>
</html>